<h2> <%= @image.title %> </h2>
<h4> <%= link_to @image.user.name, user_path(@image.user) %> </h4>

<% if !current_user.get_favorite(@image) %>
  <%= form_tag(image_favorites_path(@image), method: 'post') do %>
    <%= submit_tag "Favorite", class: 'btn btn-primary' %>
  <% end %>
<% else %>
  <%= form_tag(image_favorite_path(@image, current_user.get_favorite(@image)), method: 'delete') do %>
    <%= submit_tag "Unfavorite", class: 'btn btn-primary' %>
  <% end %>
<% end %>

<div class="image">
  <%= image_tag(@image.photo.url(:medium)) %>
</div>

<p> <%= @image.caption %> </p>

<% if @image.user == current_user %>
  <p>
    <%= link_to "Edit", edit_image_path(@image) %> |
    <%= link_to "Delete", image_path(@image), data: {
                confirm: "This will permanently delete this image. Are you sure?",
                method: "delete"
                } %>
  </p>
<% end %>

<h3>Categories</h3><hr>
<% if @image.categories.any? %>
  <% @image.categories.each do |category| %>
    <p>
      <%= link_to category.name, category_path(category) %> |
      <%= link_to "Remove", image_category_path(@image, category), data: { method: "delete" }%>
    </p>
  <% end %>
<% else %>
  <p>There are no categories.</p>
<% end %>

<hr>

<% if current_user %>
  <% if @categories.any? %>
    <%= form_tag(image_category_path(@image, @category), method: 'patch') do %>
      <%= label_tag "Add Existing Category" %>
      <%= collection_select :category, :id, @categories, :id, :name, {}, class: "form-control" %>
      <%= submit_tag "Add Category", class: "btn btn-primary" %>
    <% end %>
  <% end %>
  <hr>
  <%= form_tag(image_categories_path(@image), method: 'post') do %>
    <%= label_tag "New Category" %>
    <%= text_field_tag :name, nil, class: "form-control" %>
    <%= submit_tag "Create Category", class: "btn btn-primary" %>
  <% end %>
<% end %>
